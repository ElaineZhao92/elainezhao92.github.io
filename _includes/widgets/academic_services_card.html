{% comment %} Group services by conference name {% endcomment %}
{% assign services_by_conference = site.data.academic_services.services | group_by: "conference" %}

<div class="my-3 bg-white shadow-sm rounded-xl">
    <h6 class="p-3 mb-0 border-bottom border-gray"><i class="fas fa-gavel"></i><span style="margin-left: 0.3em;">Academic Services</span></h6>
    <div class="px-3 pb-1">
        {% for conference_group in services_by_conference %}
        <div class="my-1 {% if not_first -%}border-top border-gray pt-2 mt-2{%- endif %}">
            {% assign not_first = true %}
            {% comment %} Collect all years for this conference {% endcomment %}
            {% assign conference_years = "" | split: "," %}
            {% assign conference_role = "" %}
            {% for service in conference_group.items %}
              {% if service.role %}
                {% assign conference_role = service.role %}
              {% endif %}
              {% if service.years %}
                {% for year in service.years %}
                  {% assign year_str = year | append: "" %}
                  {% unless conference_years contains year_str %}
                    {% assign conference_years = conference_years | push: year_str %}
                  {% endunless %}
                {% endfor %}
              {% elsif service.year %}
                {% assign year_str = service.year | append: "" %}
                {% unless conference_years contains year_str %}
                  {% assign conference_years = conference_years | push: year_str %}
                {% endunless %}
              {% endif %}
            {% endfor %}
            {% assign conference_years = conference_years | sort | reverse %}
            
            <div>
                <strong>{{ conference_group.name }}</strong>
                {% if conference_role %}
                <span class="text-muted"> - {{ conference_role }}</span>
                {% endif %}
                {% if conference_years.size > 0 %}
                <span class="text-muted"> ({{ conference_years | join: ", " }})</span>
                {% endif %}
            </div>
        </div>
        {% endfor %}
    </div>
</div>

